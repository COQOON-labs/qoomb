# ==============================================================================
# Qoomb Environment Configuration
# ==============================================================================
# Copy this file to .env and fill in the values
# IMPORTANT: Never commit .env to version control!

# ==============================================================================
# ENVIRONMENT
# ==============================================================================
NODE_ENV="development" # development | production | test

# ==============================================================================
# SERVER CONFIGURATION
# ==============================================================================
PORT=3001

# ==============================================================================
# DATABASE (Required)
# ==============================================================================
# PostgreSQL connection string
# Format: postgresql://username:password@host:port/database
DATABASE_URL="postgresql://qoomb:qoomb_dev_password@localhost:5432/qoomb"

# ==============================================================================
# REDIS (Required)
# ==============================================================================
# Redis connection string for caching and session management
REDIS_URL="redis://localhost:6379"

# ==============================================================================
# SECURITY - JWT (Required)
# ==============================================================================
# JWT secret for signing tokens
# PRODUCTION: Generate a strong random string (minimum 32 characters)
# Command: openssl rand -base64 32
JWT_SECRET="change-me-in-production-must-be-at-least-32-chars-long"

# JWT token expiration time (e.g., "7d", "24h", "60m")
JWT_EXPIRES_IN="7d"

# ==============================================================================
# SECURITY - Key Management (Required)
# ==============================================================================
# Key provider determines how encryption keys are managed
# Options: environment | file | aws-kms | vault
# IMPORTANT: This MUST be explicitly set (no default for security)
KEY_PROVIDER=environment

# --- Option 1: Environment Provider (Recommended for most cases) ---
# Load encryption key from environment variable
# PRODUCTION: Generate a strong random key
# Command: openssl rand -base64 32
ENCRYPTION_KEY="change-me-in-production-base64-encoded-32-chars"

# --- Key Rotation (environment provider only) ---
# To rotate the master key without downtime:
#   1. Generate new key:  openssl rand -base64 32
#   2. Replace ENCRYPTION_KEY above with the three vars below, then restart app.
#      The app encrypts new data with V_CURRENT, still decrypts older V1 data.
#   3. Run:  pnpm --filter @qoomb/api db:reencrypt          (dry run)
#            pnpm --filter @qoomb/api db:reencrypt --execute
#   4. Once complete: remove _V1 + _CURRENT; rename _V2 back to ENCRYPTION_KEY.
#
# ENCRYPTION_KEY_CURRENT=2
# ENCRYPTION_KEY_V1=<old key — keep until re-encryption completes>
# ENCRYPTION_KEY_V2=<new key from: openssl rand -base64 32>

# --- Option 2: File Provider (Advanced self-hosting) ---
# Load encryption key from encrypted file
# KEY_PROVIDER=file
# KEY_FILE_PATH=/secrets/master-key.enc
# KEY_FILE_PASSWORD="your-strong-password-min-20-chars"

# --- Option 3: AWS KMS (Enterprise, requires @aws-sdk/client-kms) ---
# Use AWS Key Management Service
# KEY_PROVIDER=aws-kms
# AWS_REGION=eu-central-1
# AWS_KMS_KEY_ID=arn:aws:kms:eu-central-1:123456789:key/abc-123
# AWS_ACCESS_KEY_ID=<your-access-key>
# AWS_SECRET_ACCESS_KEY=<your-secret-key>

# --- Option 4: HashiCorp Vault (Enterprise self-hosted, requires node-vault) ---
# Use Vault for key management
# KEY_PROVIDER=vault
# VAULT_ADDR=https://vault.company.com
# VAULT_TOKEN=<your-vault-token>
# VAULT_KEY_PATH=secret/data/qoomb/encryption-master-key

# ==============================================================================
# SECURITY - Password Hashing
# ==============================================================================
# bcrypt salt rounds (10-12 recommended, higher = more secure but slower)
BCRYPT_SALT_ROUNDS=10

# ==============================================================================
# SECURITY - Rate Limiting
# ==============================================================================
# Enable/disable rate limiting (true/false)
RATE_LIMIT_ENABLED=true

# ==============================================================================
# SECURITY - Trusted Proxy
# ==============================================================================
# Number of trusted proxy hops (integer) or IP/CIDR of the reverse proxy.
# Prevents X-Forwarded-For spoofing which would bypass rate limiting.
# Default: 1 (trust exactly one proxy hop — correct for most deployments)
# Examples: 1, "127.0.0.1", "10.0.0.0/8"
# TRUSTED_PROXY=1

# ==============================================================================
# SECURITY - CORS
# ==============================================================================
# Comma-separated list of allowed origins for CORS
# Development: usually includes localhost
# Production: your actual domain(s)
ALLOWED_ORIGINS="http://localhost:5173,http://localhost:3000"

# ==============================================================================
# SECURITY - Session (Optional)
# ==============================================================================
# Session secret for encrypting session data
# Command: openssl rand -base64 32
SESSION_SECRET="change-me-in-production-session-secret-32-chars"

# ==============================================================================
# FEATURE FLAGS
# ==============================================================================
# Allow anyone to register a new hive (false = invite-only, DEFAULT)
# Set to true only if you want open registration
ALLOW_OPEN_REGISTRATION=false

# Allow users to request a password reset via email (false = disabled, DEFAULT)
# Set to true only if email delivery is configured
ALLOW_FORGOT_PASSWORD=false

# Allow PassKey (WebAuthn) authentication (true = enabled, DEFAULT)
ALLOW_PASSKEYS=true

# Enable/disable external calendar synchronization
ENABLE_EXTERNAL_CALENDAR_SYNC=false

# ==============================================================================
# LOGGING
# ==============================================================================
# Log level: error | warn | info | debug | verbose
LOG_LEVEL="info"

# ==============================================================================
# LOCALE
# ==============================================================================
# Platform-wide default locale (BCP 47 tag).
# Lowest-priority fallback — overridden by hive and user preferences.
# Examples: "en-US", "en-GB", "de-DE", "de-AT"
DEFAULT_LOCALE="en-US"

# ==============================================================================
# EMAIL CONFIGURATION (Optional - for future use)
# ==============================================================================
# SMTP server configuration for sending emails
SMTP_HOST=""
SMTP_PORT=587
SMTP_USER=""
SMTP_PASSWORD=""
SMTP_FROM=""

# ==============================================================================
# FRONTEND (for Vite)
# ==============================================================================
# API URL that the frontend will connect to
VITE_API_URL="http://localhost:3001"

# ==============================================================================
# PRODUCTION DEPLOYMENT NOTES
# ==============================================================================
# 1. Generate strong secrets:
#    - JWT_SECRET: openssl rand -base64 32
#    - ENCRYPTION_KEY: openssl rand -base64 32
#    - SESSION_SECRET: openssl rand -base64 32
#
# 2. Update DATABASE_URL with production credentials
#
# 3. Update REDIS_URL with production credentials
#
# 4. Set ALLOWED_ORIGINS to your production domain(s)
#
# 5. Set NODE_ENV to "production"
#
# 6. Consider increasing BCRYPT_SALT_ROUNDS to 12 for production
#
# 7. Review and enable/disable feature flags as needed
#
# 8. Set up SMTP for email functionality
#
# 9. Never expose this file publicly - keep it secure!
#
# 10. Use environment-specific .env files:
#     - .env.development
#     - .env.production
#     - .env.test
# ==============================================================================
